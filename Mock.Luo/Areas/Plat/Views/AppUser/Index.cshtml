@{
    Layout = "~/Views/Shared/_Index.cshtml";
    ViewBag.Title = "用户管理列表首页";
}

<!-- Content Header (Page header) -->
<section class="content-header">
    <ol class="breadcrumb" style="margin-bottom:0px;">
        <li><a href="#"><i class="fa fa-dashboard"></i> 后台管理</a></li>
        <li class="active">用户信息管理</li>
    </ol>
</section>
<section class="content">
    <div class="panel panel-default">
        <div class="panel-body" style="padding-top: -13px;padding-bottom:0" id="v-app">
            <form id="formSearch" class="form-horizontal">
                <div class="form-group" style="margin-top:5px">
                    <label class="control-label col-sm-1" for="txt_search_name">登录名</label>
                    <div class="col-sm-3">
                        <input type="text" class="form-control" v-model="LoginName">
                    </div>
                    <label class="control-label col-sm-1" for="txt_search_statu">邮件</label>
                    <div class="col-sm-3">
                        <input type="text" class="form-control" v-model="Email">
                    </div>
                    <div class="col-sm-4" style="text-align:left;">
                        <button type="button" style="margin-left:50px" id="btn_query" v-on:click="btn_query" class="btn btn-primary"><i class="glyphicon glyphicon-search"></i> 查询</button>
                    </div>
                </div>
            </form>
            <div id="toolbar" class="btn-group">
                <button id="btn_add" type="button" class="btn btn-default" v-on:click="btn_add">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
                </button>
                <button id="btn_edit" type="button" class="btn btn-default" v-on:click="btn_edit">
                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>编辑
                </button>
                <button id="btn_delete" type="button" class="btn btn-default" v-on:click="btn_delete">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                </button>
            </div>
        </div>
        <div class="panel-body" style="padding-top: 0;padding-bottom:0">
            <table id="dginfo"></table>
        </div>
    </div>
</section>
@section scripts{
    <script type="text/javascript">

        var vm = new Vue({
            el: '#v-app',
            data: {
                LoginName: '',
                Email: '',
            },
            methods: {
                btn_add: function () {
                    this.editinfo('新增用户', 0);
                },
                btn_edit: function () {
                    com.edit('#dginfo','boot', function (Id) {
                        vm.editinfo('编辑用户', Id);
                    });
                },
                btn_delete: function () {
                    com.delete('/Plat/AppUser/Delete');
                },
                btn_query: function () {
                    $('#dginfo').bootstrapTable('refresh');
                },
                btn_clear: function () {
                    this.Email = '';
                    this.LoginName = '';
                    $('#dginfo').bootstrapTable("refresh");
                },
                editinfo: function (title, Id) {
                    $.layerOpen({
                        title: title,
                        width: '50%',
                        height: '70%',
                        content: '/Plat/AppUser/Form/' + Id,
                        yes: function (iframebody, iframeWin, index) {
                            iframeWin.vm.submit(function () {
                                vm.btn_clear();
                            });
                        }
                    });
                }
            }
        });

        var TableInit = function () {
            var oTableInit = new Object();
            //初始化Table
            oTableInit.Init = function () {
                $('#dginfo').dataGrid({
                    url: '/Plat/AppUser/GetDataGrid', //请求后台的URL（*）
                    sortOrder: "desc,asc", //排序方式
                    sortName: 'LoginName,Id',
                    queryParams: oTableInit.queryParams,
                    uniqueId: "Id",
                    columns: [{ checkbox: true },
                        { field: 'LoginName', title: '登录名', sortable: true },
                        { field: 'Email', title: '邮件', sortable: true },
                        { field: 'NickName', title: '昵称', sortable: true },
                        {
                            field: 'Id', title: '配置角色', formatter: function (value, row) {
                                return String(row.UserRoleList)
                            }
                        },
                        { field: 'LoginCount', title: '登录次数', sortable: true },
                        { field: 'LastLoginTime', title: '最后登录时间', sortable: true }]
                });
            };

            //得到查询的参数
            oTableInit.queryParams = function (params) {
                params.Email = vm.Email;
                params.LoginName = vm.LoginName;
                return params;
            };
            return oTableInit;
        };

        $(function () {
            //初始化Table
            var oTable = new TableInit();
            oTable.Init();
        });

    </script>
}
